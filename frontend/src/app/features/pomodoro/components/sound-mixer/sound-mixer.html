<div class="relative">
  <button
    class="w-12 h-12 rounded-full bg-white/5 text-text-muted flex items-center justify-center transition-all duration-200 border border-transparent hover:bg-surface-hover hover:text-text"
    [class.bg-primary]="isOpen()" [class.text-bg]="isOpen()" [class.shadow-[0_0_15px_rgba(99,102,241,0.3)]]="isOpen()"
    (click)="toggleMixer()" title="Sound Mixer">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 6v13" />
      <path d="M19.129 17.435a7 7 0 0 0-5.356-12.801" />
      <path d="M4.871 17.435A7 7 0 0 1 10.227 4.634" />
    </svg>
  </button>

  @if (isOpen() === 'soundMixer') {
  <div
    class="absolute bottom-full left-0 mb-4 bg-surface/90 backdrop-blur-md border border-white/10 rounded-xl p-4 flex flex-col gap-4 min-w-[200px] animate-[slideUp_0.2s_ease-out] shadow-lg">
    @for (sound of audioService.whiteNoises(); track sound.id) {
    <div class="flex items-center gap-4">
      <button
        class="w-10 h-10 rounded-full bg-white/5 text-text-muted flex items-center justify-center transition-all duration-200 shrink-0 hover:bg-surface-hover hover:text-text"
        [class.bg-black]="!sound.enabled" [class.text-black]="!sound.enabled" [innerHTML]="sound.icon"
        (click)="audioService.toggleWhiteNoise(sound.id)">
      </button>
      <div class="flex-1" [class.pointer-events-none]="!sound.enabled" [class.opacity-30]="!sound.enabled">
        <input
          class="w-full h-1 bg-white/10 rounded-sm appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-text [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:transition-transform [&::-webkit-slider-thumb]:hover:scale-125"
          type="range" min="0" max="1" step="0.1" [value]="sound.volume"
          (input)="onWhiteNoiseVolumeChange(sound.id, $event)">
      </div>
      <span class="flex-1">{{ (sound.volume * 100).toFixed(0) }}%</span>
    </div>
    }
  </div>
  }
</div>